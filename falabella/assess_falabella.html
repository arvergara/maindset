<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Encuesta Explora: Madurez y Mapeo de Workflows con IA Generativa
    </title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #e3f2fd 0%, #f5f5f5 100%);
        min-height: 100vh;
        padding: 20px;
        display: flex; /* For centering the container */
        align-items: flex-start; /* Align to top for scrollability */
        justify-content: center; /* Center horizontally */
      }

      .survey-container {
        width: 100%; /* Full width on small screens */
        max-width: 800px; /* Max width on larger screens */
        margin: 20px auto; /* Vertical margin, auto for horizontal centering */
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .progress-bar {
        height: 8px; /* Slightly thicker for better visibility */
        background: #e0e0e0;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          #4caf50,
          #81c784
        ); /* Softer green gradient */
        width: 0%;
        transition: width 0.4s ease; /* Smoother transition */
        border-radius: 0 4px 4px 0; /* Rounded edge for fill */
      }

      .survey-header {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        padding: 30px 40px; /* Adjusted padding */
        text-align: center;
      }

      .survey-title {
        font-size: 1.8em; /* Adjusted for responsiveness */
        font-weight: 700;
        margin-bottom: 8px;
      }

      .survey-subtitle {
        font-size: 1em; /* Adjusted for responsiveness */
        opacity: 0.9;
      }

      .survey-content {
        padding: 30px; /* Adjusted padding */
      }

      .block {
        display: none;
        animation: fadeIn 0.5s ease-in-out; /* Smoother animation */
      }

      .block.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .block-title {
        font-size: 1.4em; /* Adjusted for responsiveness */
        color: #1e88e5; /* Slightly different blue */
        margin-bottom: 25px;
        border-bottom: 2px solid #bbdefb; /* Lighter border */
        padding-bottom: 12px;
      }

      .intro-text {
        background: #e3f2fd; /* Lighter blue background */
        padding: 20px;
        border-radius: 12px;
        border-left: 5px solid #2196f3;
        margin-bottom: 30px;
        line-height: 1.7; /* Increased line height */
        font-size: 0.95em;
      }
      .intro-text h2 {
        font-size: 1.3em;
        color: #1565c0; /* Darker blue for heading */
        margin-bottom: 10px;
      }
      .intro-text p {
        margin-bottom: 10px;
      }
      .intro-text strong {
        color: #1565c0;
      }
      .intro-text em {
        color: #555;
        font-style: italic;
      }

      .question {
        margin-bottom: 30px; /* Increased spacing */
        padding: 20px;
        background: #fdfdfd; /* Slightly off-white */
        border-radius: 12px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Subtle shadow */
      }

      .question-label {
        font-weight: 600;
        margin-bottom: 15px;
        color: #333;
        font-size: 1.05em; /* Slightly larger label */
        display: block; /* Ensure it takes full width */
      }
      .question-label strong {
        color: #1e88e5;
      }
      .question-label .instruction {
        font-size: 0.85em;
        font-weight: normal;
        color: #555;
        display: block;
        margin-top: 5px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      input[type="text"],
      input[type="number"],
      textarea,
      select {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #ccc; /* Standard border */
        border-radius: 8px;
        font-size: 1em; /* Relative font size */
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        background-color: #fff;
      }

      input[type="text"]:focus,
      input[type="number"]:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #2196f3;
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2); /* Softer focus shadow */
      }
      textarea {
        min-height: 80px; /* Minimum height for textareas */
        resize: vertical; /* Allow vertical resize */
      }

      .radio-group,
      .checkbox-group {
        display: flex;
        flex-direction: column; /* Stack options vertically */
        gap: 12px; /* Space between options */
        margin-top: 10px;
      }

      .radio-option,
      .checkbox-option {
        display: flex;
        align-items: center;
        background: white;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease; /* Faster transition */
      }
      .checkbox-option input[type="checkbox"] {
        margin-right: 10px;
        width: 18px;
        height: 18px;
        accent-color: #2196f3;
      }
      .checkbox-option .otro-input-container {
        margin-left: 10px;
        flex-grow: 1;
      }
      .checkbox-option .otro-input-container input[type="text"] {
        width: 100%;
        padding: 8px 10px;
        font-size: 0.9em;
        border-radius: 6px;
      }

      .radio-option:hover,
      .checkbox-option:hover {
        border-color: #64b5f6; /* Lighter blue on hover */
        transform: translateY(-1px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
      }

      .radio-option.selected,
      .checkbox-option.selected {
        border-color: #2196f3;
        background: #e3f2fd; /* Light blue background when selected */
        box-shadow: 0 2px 4px rgba(33, 150, 243, 0.2);
      }
      .radio-option.selected span,
      .checkbox-option.selected span:not(.otro-input-container) {
        font-weight: 500; /* Slightly bolder text when selected */
        color: #1967d2;
      }

      .radio-option input,
      .checkbox-option input[type="radio"] {
        /* Keep specific for radio if needed */
        margin-right: 10px; /* Increased margin */
        width: 18px; /* Custom size for radio/checkbox */
        height: 18px;
        accent-color: #2196f3; /* Color the check/dot */
      }

      .likert-scale {
        display: flex;
        justify-content: space-around; /* Even spacing */
        align-items: center;
        margin: 20px 0 10px 0; /* Adjusted margin */
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }

      .likert-labels {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 5px; /* Reduced gap */
        width: 100%;
        font-size: 0.75em; /* Smaller labels */
        color: #555; /* Darker grey */
        margin-top: 5px;
        text-align: center;
      }

      .likert-labels span {
        padding: 0 2px;
      }

      .scale-option {
        width: 38px; /* Slightly smaller */
        height: 38px;
        border: 2px solid #e0e0e0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: bold;
        background-color: #f9f9f9; /* Light background */
      }

      .scale-option:hover {
        border-color: #64b5f6;
        transform: scale(1.08); /* Slightly larger scale on hover */
        background-color: #e3f2fd;
      }

      .scale-option.selected {
        background: #2196f3;
        color: white;
        border-color: #1976d2; /* Darker border when selected */
        transform: scale(1.1);
      }

      .workflow-category {
        background: white;
        margin-bottom: 25px;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .category-header {
        background: #64b5f6; /* Lighter blue for category header */
        color: white;
        padding: 12px 20px; /* Adjusted padding */
        font-weight: 600;
        font-size: 1.05em;
      }

      .category-content {
        padding: 15px 20px; /* Adjusted padding */
      }

      .workflow-item {
        display: flex;
        align-items: center;
        padding: 12px 0; /* Increased padding */
        border-bottom: 1px solid #f0f0f0;
      }
      .workflow-item label {
        /* Make label clickable for checkbox */
        flex-grow: 1;
        font-size: 0.95em;
        cursor: pointer;
        margin-left: 5px; /* Space between checkbox and label text */
      }

      .workflow-item:last-child {
        border-bottom: none;
      }

      .workflow-checkbox {
        margin-right: 10px; /* Adjusted margin */
        width: 18px;
        height: 18px;
        accent-color: #2196f3;
        flex-shrink: 0; /* Prevent checkbox from shrinking */
      }

      .workflow-details {
        display: none;
        margin-top: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }
      .workflow-details h3 {
        font-size: 1.2em;
        color: #1e88e5;
        margin-bottom: 15px;
      }

      .workflow-details.active {
        display: block;
      }
      .detail-row-container {
        /* Wrapper for each workflow's details */
        margin-bottom: 20px;
        padding: 15px;
        background: white;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
      }
      .detail-row-container > div:first-child {
        /* Workflow name styling */
        font-weight: bold;
        margin-bottom: 10px;
        color: #2196f3;
        font-size: 1.05em;
      }

      .detail-row {
        /* For Frequency, Pain, Level selects */
        display: flex;
        flex-wrap: wrap; /* Allow wrapping on small screens */
        gap: 15px;
        margin-bottom: 10px; /* Reduced margin */
        align-items: center;
      }

      .detail-item {
        flex: 1;
        min-width: 150px; /* Minimum width for detail items */
      }

      .detail-item label {
        display: block;
        font-size: 0.85em; /* Smaller label */
        color: #555;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .detail-item select {
        padding: 10px 12px; /* Adjusted padding */
        font-size: 0.95em;
      }

      .ranking-list {
        min-height: 150px; /* Reduced min-height */
        border: 2px dashed #b0bec5; /* Softer dashed border */
        border-radius: 8px;
        padding: 15px;
        background: #eceff1; /* Light grey background */
        margin-top: 10px;
      }
      .ranking-list p {
        /* Placeholder text styling */
        color: #546e7a;
        text-align: center;
        font-style: italic;
        padding: 20px 0;
      }

      .ranking-item {
        background: white;
        padding: 12px 15px;
        margin-bottom: 10px;
        border-radius: 8px;
        cursor: grab; /* Indicate draggable */
        border: 1px solid #cfd8dc; /* Lighter border */
        transition: all 0.2s ease;
        display: flex; /* For aligning number and text */
        align-items: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .ranking-item:hover {
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        border-color: #90a4ae;
        transform: translateY(-1px);
      }
      .ranking-item.dragging {
        opacity: 0.6;
        background: #e3f2fd;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        cursor: grabbing;
      }
      .ranking-item span:first-child {
        /* Number styling */
        font-weight: bold;
        margin-right: 10px;
        color: #546e7a;
        min-width: 20px; /* Ensure space for two digits */
      }
      .ranking-item span:last-child {
        /* Drag handle icon */
        margin-left: auto;
        color: #78909c;
        cursor: grab;
        font-size: 1.2em;
      }

      .navigation-buttons {
        display: flex;
        justify-content: space-between;
        align-items: center; /* Vertically align items if they wrap */
        flex-wrap: wrap; /* Allow buttons to wrap on small screens */
        gap: 15px; /* Gap between buttons if they wrap */
        margin-top: 35px;
        padding-top: 25px;
        border-top: 1px solid #e0e0e0;
      }

      .btn {
        padding: 12px 25px; /* Adjusted padding */
        border: none;
        border-radius: 8px;
        font-size: 1em; /* Relative font size */
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 600;
        min-width: 120px; /* Minimum width for buttons */
        text-align: center;
      }

      .btn-primary {
        background: #2196f3;
        color: white;
        box-shadow: 0 2px 5px rgba(33, 150, 243, 0.2);
      }
      .btn-primary:hover {
        background: #1976d2;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
      }

      .btn-secondary {
        background: #78909c; /* Greyish blue */
        color: white;
        box-shadow: 0 2px 5px rgba(120, 144, 156, 0.2);
      }
      .btn-secondary:hover {
        background: #546e7a;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(120, 144, 156, 0.3);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .completion-message {
        text-align: center;
        padding: 50px 30px; /* Adjusted padding */
      }
      .completion-title {
        font-size: 1.8em;
        color: #4caf50;
        margin-bottom: 15px;
      }
      .completion-text {
        font-size: 1.1em;
        color: #555;
        line-height: 1.7;
      }

      .validation-message {
        color: #d32f2f; /* Darker red */
        font-size: 0.9em;
        margin-top: 15px;
        padding: 10px 15px;
        background: #ffcdd2; /* Lighter red background */
        border: 1px solid #ef9a9a; /* Reddish border */
        border-radius: 6px;
        display: none;
        text-align: center; /* Center align validation message */
        width: 100%; /* Make it full width in its container */
      }
      .validation-message.show {
        display: block;
        animation: shake 0.3s; /* Shake animation for errors */
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        50% {
          transform: translateX(5px);
        }
        75% {
          transform: translateX(-5px);
        }
      }

      /* Additional Workflows Styling */
      .additional-workflow {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 15px;
        border: 1px solid #e9ecef;
      }
      .additional-workflow .form-group label {
        font-size: 0.9em;
        color: #444;
      }
      #addWorkflowBtn {
        margin-top: 10px;
        background-color: #90a4ae; /* Different color for add button */
      }
      #addWorkflowBtn:hover {
        background-color: #607d8b;
      }
      .btn-remove-wf {
        /* Styling for remove button in additional workflows */
        background: #ef5350; /* Reddish color */
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 6px;
        margin-top: 10px;
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color 0.2s ease;
      }
      .btn-remove-wf:hover {
        background: #d32f2f;
      }

      /* Responsive adjustments */
      @media (max-width: 800px) {
        /* Apply when screen is narrower than container max-width */
        body {
          padding: 10px; /* Reduce body padding */
        }
        .survey-container {
          margin: 10px; /* Reduce margin */
          border-radius: 15px; /* Slightly smaller radius */
        }
        .survey-header {
          padding: 25px 20px;
        }
        .survey-title {
          font-size: 1.6em;
        }
        .survey-subtitle {
          font-size: 0.95em;
        }
        .survey-content {
          padding: 20px;
        }
        .block-title {
          font-size: 1.3em;
        }
        .intro-text {
          padding: 15px;
          font-size: 0.9em;
        }
        .question {
          padding: 15px;
        }
        .question-label {
          font-size: 1em;
        }
        input[type="text"],
        input[type="number"],
        textarea,
        select {
          padding: 10px 14px;
          font-size: 0.95em;
        }
        .radio-option,
        .checkbox-option {
          padding: 10px 14px;
        }
        .likert-scale {
          padding: 10px;
          flex-wrap: wrap; /* Allow scale options to wrap */
          justify-content: center; /* Center wrapped items */
          gap: 5px;
        }
        .scale-option {
          width: 35px;
          height: 35px;
        }
        .likert-labels {
          font-size: 0.7em;
          grid-template-columns: repeat(
            auto-fit,
            minmax(50px, 1fr)
          ); /* Responsive columns */
        }
        .category-header {
          font-size: 1em;
          padding: 10px 15px;
        }
        .category-content {
          padding: 10px 15px;
        }
        .workflow-item {
          padding: 10px 0;
        }
        .detail-row {
          flex-direction: column; /* Stack detail items vertically */
          gap: 10px;
          align-items: stretch; /* Stretch items to full width */
        }
        .detail-item {
          min-width: 0; /* Reset min-width for stacked items */
        }
        .navigation-buttons {
          flex-direction: column; /* Stack buttons vertically */
          gap: 10px;
        }
        .btn {
          width: 100%; /* Make buttons full width */
        }
        .completion-message {
          padding: 30px 20px;
        }
        .completion-title {
          font-size: 1.6em;
        }
        .completion-text {
          font-size: 1em;
        }
      }
      @media (max-width: 480px) {
        /* Further adjustments for very small screens */
        .survey-header {
          padding: 20px 15px;
        }
        .survey-title {
          font-size: 1.4em;
        }
        .survey-subtitle {
          font-size: 0.85em;
        }
        .survey-content {
          padding: 15px;
        }
        .block-title {
          font-size: 1.2em;
        }
        .intro-text {
          font-size: 0.85em;
        }
        .question-label {
          font-size: 0.95em;
        }
        .likert-labels span {
          line-height: 1.3; /* Improve readability of wrapped labels */
        }
        .ranking-item span:last-child {
          /* Drag handle icon */
          font-size: 1.1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="survey-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="survey-header">
        <h1 class="survey-title">Encuesta Explora</h1>
        <p class="survey-subtitle">
          Madurez y Mapeo de Workflows con IA Generativa
        </p>
      </div>

      <div class="survey-content">
        <div class="block active" id="intro">
          <div class="intro-text">
            <h2>¡Bienvenido(a)!</h2>
            <p>
              En menos de 10 minutos, esta encuesta te ayudará a diagnosticar tu
              nivel de familiaridad con la Inteligencia Artificial Generativa y
              a identificar tareas repetitivas en tu día a día que podrían ser
              optimizadas o automatizadas mediante agentes de IA.
            </p>
            <p>
              <strong>Tus respuestas son confidenciales</strong> y se utilizarán
              exclusivamente para entender mejor las necesidades, priorizar
              futuros talleres de capacitación y desarrollar prototipos de IA
              enfocados en liberar tu tiempo y potenciar tu trabajo diario.
            </p>
            <p><em>Tiempo estimado para completar: ≤ 8 minutos</em></p>
          </div>
          <div class="navigation-buttons">
            <div style="flex-grow: 1"></div>
            <button class="btn btn-primary" onclick="nextBlock()">
              Comenzar Encuesta
            </button>
          </div>
        </div>

        <div class="block" id="blockA">
          <h2 class="block-title">Bloque A: Datos Básicos</h2>

          <div class="question">
            <label class="question-label" for="nombre_completo_a"
              >1. Nombre completo</label
            >
            <input
              type="text"
              id="nombre_completo_a"
              name="nombre_completo"
              placeholder="Ej: Juan Pérez"
            />
          </div>

          <div class="question">
            <label class="question-label" for="cargo_actual_a"
              >2. Cargo actual</label
            >
            <input
              type="text"
              id="cargo_actual_a"
              name="cargo_actual"
              placeholder="Ej: Gerente de Marketing"
            />
          </div>

          <div class="question">
            <label class="question-label" for="area_departamento_a"
              >3. Área o departamento</label
            >
            <input
              type="text"
              id="area_departamento_a"
              name="area_departamento"
              placeholder="Ej: Marketing Digital, Recursos Humanos, Finanzas"
            />
          </div>

          <div class="question">
            <label class="question-label"
              >4. Tamaño de tu equipo directo (personas que te reportan)</label
            >
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="tamano_equipo" value="0" />
                <span>0 (No tengo equipo a cargo)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="tamano_equipo" value="1-5" />
                <span>1-5</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="tamano_equipo" value="6-15" />
                <span>6-15</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="tamano_equipo" value="16-30" />
                <span>16-30</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="tamano_equipo" value=">30" />
                <span>Más de 30</span>
              </label>
            </div>
          </div>

          <div class="question">
            <label class="question-label"
              >5. Aproximadamente, ¿qué porcentaje de tu tiempo laboral dedicas
              a tareas operativas o repetitivas?</label
            >
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="tiempo_operativo" value="0-25" />
                <span>0-25%</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="tiempo_operativo" value="26-50" />
                <span>26-50%</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="tiempo_operativo" value="51-75" />
                <span>51-75%</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="tiempo_operativo" value="76-100" />
                <span>76-100%</span>
              </label>
            </div>
          </div>

          <div class="question">
            <label class="question-label"
              >6.
              <strong
                >Autoevaluación de familiaridad con herramientas de IA
                Generativa (como ChatGPT, Claude, Gemini, Copilot, etc.)</strong
              ></label
            >
            <div class="likert-scale">
              <div class="scale-option" data-value="1">1</div>
              <div class="scale-option" data-value="2">2</div>
              <div class="scale-option" data-value="3">3</div>
              <div class="scale-option" data-value="4">4</div>
              <div class="scale-option" data-value="5">5</div>
            </div>
            <div class="likert-labels">
              <span>Nunca las he usado / No sé qué son</span>
              <span>Las he usado muy rara vez / superficialmente</span>
              <span>Las uso ocasionalmente para tareas puntuales</span>
              <span>Las uso frecuentemente y empiezo a ver su potencial</span>
              <span>Las uso a diario, son parte esencial de mi trabajo</span>
            </div>
            <input
              type="hidden"
              name="familiaridad_score"
              id="familiaridadScore"
            />
          </div>
          <div class="validation-message" id="validationMessageA">
            Por favor, responde todas las preguntas de este bloque para
            continuar.
          </div>
          <div class="navigation-buttons">
            <button class="btn btn-secondary" onclick="prevBlock()">
              Anterior
            </button>
            <button class="btn btn-primary" onclick="nextBlock()">
              Siguiente
            </button>
          </div>
        </div>

        <div class="block" id="blockB">
          <h2 class="block-title">Bloque B: Conocimiento y Confianza en IA</h2>

          <div id="knowledgeQuiz" class="question">
            <label class="question-label"
              ><strong>B.1 Conocimientos clave sobre IA Generativa</strong
              ><br />Indica tu nivel de acuerdo con las siguientes
              afirmaciones:</label
            >

            <div class="question sub-question">
              <label class="question-label"
                >Comprendo qué es un LLM (Large Language Model o Modelo
                Lingüístico Extenso)</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b1_1" id="b1_1" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >Sé qué es la "ingeniería de prompts" (prompt engineering) y su
                importancia</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b1_2" id="b1_2" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >Entiendo el concepto de un "agente de IA" y cómo podría
                automatizar tareas</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b1_3" id="b1_3" />
            </div>
          </div>

          <div class="question">
            <label class="question-label"
              ><strong>B.2 Termómetro Organizacional sobre IA</strong
              ><br />Respecto a tu entorno laboral actual:</label
            >

            <div class="question sub-question">
              <label class="question-label"
                >Mi área/empresa dispone de lineamientos claros sobre el uso
                ético y seguro de la IA</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral / No lo sé</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b2_1" id="b2_1" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >Tenemos acceso oficial y fomentado a herramientas o licencias
                de IA Generativa</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral / No lo sé</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b2_2" id="b2_2" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >La dirección de mi empresa/área impulsa activamente la
                exploración o pilotos con IA y provee recursos para ello</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral / No lo sé</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b2_3" id="b2_3" />
            </div>
          </div>

          <div class="question">
            <label class="question-label"
              ><strong>B.3 Percepción Personal y Barreras</strong><br />Sobre tu
              propia perspectiva:</label
            >

            <div class="question sub-question">
              <label class="question-label"
                >Siento confianza y curiosidad para experimentar con IA
                Generativa en mis tareas diarias</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b3_1" id="b3_1" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >Me preocupa que la IA pueda reemplazar aspectos significativos
                de mi trabajo actual</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b3_2" id="b3_2" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >Me preocupa la privacidad, confidencialidad o seguridad de los
                datos al usar herramientas de IA</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b3_3" id="b3_3" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >Considero que la curva de aprendizaje para usar efectivamente
                la IA Generativa es manejable para mí</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b3_4" id="b3_4" />
            </div>

            <div class="question sub-question">
              <label class="question-label"
                >Mi equipo de trabajo está, en general, abierto y receptivo a
                adoptar nuevas herramientas tecnológicas automatizadas</label
              >
              <div class="likert-scale">
                <div class="scale-option" data-value="1">1</div>
                <div class="scale-option" data-value="2">2</div>
                <div class="scale-option" data-value="3">3</div>
                <div class="scale-option" data-value="4">4</div>
                <div class="scale-option" data-value="5">5</div>
              </div>
              <div class="likert-labels">
                <span>Totalmente en desacuerdo</span>
                <span>En desacuerdo</span>
                <span>Neutral / No lo sé</span>
                <span>De acuerdo</span>
                <span>Totalmente de acuerdo</span>
              </div>
              <input type="hidden" name="b3_5" id="b3_5" />
            </div>
          </div>
          <div class="validation-message" id="validationMessageB">
            Por favor, responde todas las preguntas de este bloque para
            continuar.
          </div>
          <div class="navigation-buttons">
            <button class="btn btn-secondary" onclick="prevBlock()">
              Anterior
            </button>
            <button class="btn btn-primary" onclick="nextBlock()">
              Siguiente
            </button>
          </div>
        </div>

        <div class="block" id="blockC">
          <h2 class="block-title">Bloque C: Mapeo de Tareas y Workflows</h2>

          <div class="intro-text">
            <h3>Instrucciones:</h3>
            <ol>
              <li>
                A continuación, verás una lista de tareas comunes agrupadas por
                categoría. Marca <strong>todas</strong> aquellas que realizas de
                forma frecuente (al menos una vez por semana).
              </li>
              <li>
                Para cada tarea que marques, se desplegarán opciones para que
                indiques:
                <ul
                  style="
                    margin-top: 10px;
                    margin-left: 20px;
                    list-style-type: disc;
                  "
                >
                  <li>
                    <strong>Frecuencia:</strong> ¿Con qué periodicidad realizas
                    esta tarea? (Diaria, Semanal, Mensual)
                  </li>
                  <li>
                    <strong>Dolor/Consumo de Tiempo:</strong> En una escala de 1
                    a 5, ¿cuánto "dolor" o tiempo consume esta tarea? (1 = Muy
                    bajo, 5 = Muy alto)
                  </li>
                  <li>
                    <strong>Nivel de Ejecución:</strong> ¿Es una tarea que
                    realizas principalmente tú (Personal) o es más bien una
                    tarea de coordinación o gestión de tu equipo (Equipo)?
                  </li>
                </ul>
              </li>
            </ol>
            <p>
              Tómate tu tiempo para reflexionar sobre tus actividades diarias y
              semanales.
            </p>
          </div>

          <div class="workflow-category">
            <div class="category-header">
              Gestión de Correo Electrónico y Comunicaciones
            </div>
            <div class="category-content">
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_clasificar_correos"
                  name="workflow_clasificar_correos"
                  data-workflow="Clasificar y priorizar correos electrónicos"
                />
                <label for="wf_clasificar_correos"
                  >Clasificar y priorizar correos electrónicos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_redactar_respuestas"
                  name="workflow_redactar_respuestas"
                  data-workflow="Redactar respuestas estándar o repetitivas a correos"
                />
                <label for="wf_redactar_respuestas"
                  >Redactar respuestas estándar o repetitivas a correos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_extraer_tareas_email"
                  name="workflow_extraer_tareas_email"
                  data-workflow="Extraer tareas o información clave de correos largos"
                />
                <label for="wf_extraer_tareas_email"
                  >Extraer tareas o información clave de correos largos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_resumir_hilos"
                  name="workflow_resumir_hilos"
                  data-workflow="Resumir hilos de correos extensos"
                />
                <label for="wf_resumir_hilos"
                  >Resumir hilos de correos extensos</label
                >
              </div>
            </div>
          </div>

          <div class="workflow-category">
            <div class="category-header">
              Creación y Gestión de Documentos y Presentaciones
            </div>
            <div class="category-content">
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_crear_borradores_doc"
                  name="workflow_crear_borradores_doc"
                  data-workflow="Crear borradores iniciales de documentos (informes, propuestas)"
                />
                <label for="wf_crear_borradores_doc"
                  >Crear borradores iniciales de documentos (informes,
                  propuestas)</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_resumir_documentos"
                  name="workflow_resumir_documentos"
                  data-workflow="Resumir documentos extensos para obtener ideas principales"
                />
                <label for="wf_resumir_documentos"
                  >Resumir documentos extensos para obtener ideas
                  principales</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_crear_slides"
                  name="workflow_crear_slides"
                  data-workflow="Crear diapositivas para presentaciones a partir de notas o documentos"
                />
                <label for="wf_crear_slides"
                  >Crear diapositivas para presentaciones a partir de notas o
                  documentos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_mejorar_redaccion"
                  name="workflow_mejorar_redaccion"
                  data-workflow="Mejorar la redacción o estilo de textos existentes"
                />
                <label for="wf_mejorar_redaccion"
                  >Mejorar la redacción o estilo de textos existentes</label
                >
              </div>
            </div>
          </div>

          <div class="workflow-category">
            <div class="category-header">Gestión de Reuniones y Tareas</div>
            <div class="category-content">
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_agendar_reuniones_multiples"
                  name="workflow_agendar_reuniones_multiples"
                  data-workflow="Agendar reuniones coordinando con múltiples asistentes"
                />
                <label for="wf_agendar_reuniones_multiples"
                  >Agendar reuniones coordinando con múltiples asistentes</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_preparar_agendas"
                  name="workflow_preparar_agendas"
                  data-workflow="Preparar agendas para reuniones"
                />
                <label for="wf_preparar_agendas"
                  >Preparar agendas para reuniones</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_transcribir_minutas"
                  name="workflow_transcribir_minutas"
                  data-workflow="Transcribir y resumir minutas de reuniones"
                />
                <label for="wf_transcribir_minutas"
                  >Transcribir y resumir minutas de reuniones</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_seguimiento_tareas_reunion"
                  name="workflow_seguimiento_tareas_reunion"
                  data-workflow="Realizar seguimiento de tareas acordadas en reuniones"
                />
                <label for="wf_seguimiento_tareas_reunion"
                  >Realizar seguimiento de tareas acordadas en reuniones</label
                >
              </div>
            </div>
          </div>

          <div class="workflow-category">
            <div class="category-header">Análisis de Datos y Reportes</div>
            <div class="category-content">
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_consolidar_datos_excel"
                  name="workflow_consolidar_datos_excel"
                  data-workflow="Consolidar datos de diversas fuentes en hojas de cálculo"
                />
                <label for="wf_consolidar_datos_excel"
                  >Consolidar datos de diversas fuentes en hojas de
                  cálculo</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_generar_graficos_simples"
                  name="workflow_generar_graficos_simples"
                  data-workflow="Generar gráficos simples o visualizaciones a partir de datos"
                />
                <label for="wf_generar_graficos_simples"
                  >Generar gráficos simples o visualizaciones a partir de
                  datos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_actualizar_reportes_periodicos"
                  name="workflow_actualizar_reportes_periodicos"
                  data-workflow="Actualizar reportes periódicos con nuevos datos"
                />
                <label for="wf_actualizar_reportes_periodicos"
                  >Actualizar reportes periódicos con nuevos datos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_identificar_tendencias_datos"
                  name="workflow_identificar_tendencias_datos"
                  data-workflow="Identificar tendencias o patrones básicos en conjuntos de datos"
                />
                <label for="wf_identificar_tendencias_datos"
                  >Identificar tendencias o patrones básicos en conjuntos de
                  datos</label
                >
              </div>
            </div>
          </div>

          <div class="workflow-category">
            <div class="category-header">
              Investigación y Recopilación de Información
            </div>
            <div class="category-content">
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_buscar_info_temas_nuevos"
                  name="workflow_buscar_info_temas_nuevos"
                  data-workflow="Buscar información y resumir hallazgos sobre temas nuevos o específicos"
                />
                <label for="wf_buscar_info_temas_nuevos"
                  >Buscar información y resumir hallazgos sobre temas nuevos o
                  específicos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_monitoreo_noticias_sector"
                  name="workflow_monitoreo_noticias_sector"
                  data-workflow="Monitorear noticias o tendencias del sector/competencia"
                />
                <label for="wf_monitoreo_noticias_sector"
                  >Monitorear noticias o tendencias del
                  sector/competencia</label
                >
              </div>
            </div>
          </div>

          <div class="workflow-category">
            <div class="category-header">
              Recursos Humanos y Gestión de Equipos (si aplica)
            </div>
            <div class="category-content">
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_filtrar_cvs_inicial"
                  name="workflow_filtrar_cvs_inicial"
                  data-workflow="Realizar un primer filtro de CVs basado en criterios definidos"
                />
                <label for="wf_filtrar_cvs_inicial"
                  >Realizar un primer filtro de CVs basado en criterios
                  definidos</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_redactar_descripciones_puesto"
                  name="workflow_redactar_descripciones_puesto"
                  data-workflow="Redactar o actualizar descripciones de puestos de trabajo"
                />
                <label for="wf_redactar_descripciones_puesto"
                  >Redactar o actualizar descripciones de puestos de
                  trabajo</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_preparar_material_onboarding"
                  name="workflow_preparar_material_onboarding"
                  data-workflow="Preparar materiales básicos para el onboarding de nuevos empleados"
                />
                <label for="wf_preparar_material_onboarding"
                  >Preparar materiales básicos para el onboarding de nuevos
                  empleados</label
                >
              </div>
              <div class="workflow-item">
                <input
                  type="checkbox"
                  class="workflow-checkbox"
                  id="wf_responder_faqs_rrhh"
                  name="workflow_responder_faqs_rrhh"
                  data-workflow="Responder preguntas frecuentes de empleados sobre políticas o beneficios"
                />
                <label for="wf_responder_faqs_rrhh"
                  >Responder preguntas frecuentes de empleados sobre políticas o
                  beneficios</label
                >
              </div>
            </div>
          </div>

          <div id="workflowDetails" class="workflow-details">
            <h3>Detalles de workflows seleccionados:</h3>
            <div id="detailsContainer"></div>
          </div>
          <div class="validation-message" id="validationMessageC">
            Debe seleccionar al menos un workflow y completar todos sus detalles
            (Frecuencia, Dolor y Nivel).
          </div>
          <div class="navigation-buttons">
            <button class="btn btn-secondary" onclick="prevBlock()">
              Anterior
            </button>
            <button class="btn btn-primary" onclick="nextBlock()">
              Siguiente
            </button>
          </div>
        </div>

        <div class="block" id="blockC2">
          <h2 class="block-title">Bloque C.2: Priorización de Workflows</h2>

          <div class="intro-text">
            <p>
              De los workflows que seleccionaste y detallaste en el paso
              anterior, por favor, arrastra y ordena los que consideres más
              importantes o de mayor impacto para ti o tu equipo. Coloca el más
              importante arriba.
            </p>
            <p>
              Si seleccionaste más de 5, aparecerán los primeros 5 basados en tu
              selección. Si deseas cambiar cuáles aparecen aquí para rankear,
              puedes volver al paso anterior.
            </p>
            <p>
              <strong
                >Arrastra para ordenar (el más importante primero):</strong
              >
            </p>
          </div>

          <div class="question">
            <label class="question-label"
              >Ranking de Workflows Seleccionados</label
            >
            <div id="rankingList" class="ranking-list">
              <p>
                Los workflows que seleccionaste y detallaste aparecerán aquí
                para que los ordenes.
              </p>
            </div>
          </div>

          <div class="question">
            <label class="question-label"
              >Workflows Adicionales No Listados (Opcional)</label
            >
            <p style="font-size: 0.9em; color: #555; margin-bottom: 15px">
              Si hay alguna tarea repetitiva importante que consumes mucho
              tiempo y no apareció en las listas anteriores, puedes agregar
              hasta <strong>dos</strong> aquí:
            </p>

            <div id="additionalWorkflows"></div>

            <button
              type="button"
              id="addWorkflowBtn"
              class="btn btn-secondary"
              onclick="addAdditionalWorkflow()"
              style="margin-top: 15px"
            >
              + Agregar Otro Workflow (Máx. 2)
            </button>
          </div>
          <div class="validation-message" id="validationMessageC2">
            Si agregas workflows adicionales, por favor completa su descripción,
            frecuencia y dolor.
          </div>
          <div class="navigation-buttons">
            <button class="btn btn-secondary" onclick="prevBlock()">
              Anterior
            </button>
            <button class="btn btn-primary" onclick="nextBlock()">
              Siguiente
            </button>
          </div>
        </div>

        <div class="block" id="blockD">
          <h2 class="block-title">Bloque D: Perspectivas Finales</h2>

          <div
            class="question"
            id="preguntaLiderNecesidadesIA"
            style="display: none"
          >
            <label class="question-label" for="lider_necesidades_ia_opcion1">
              1. Como líder, ¿cuáles consideras que son los
              <strong>tres principales elementos</strong> que tu equipo o área
              necesita para impulsar exitosamente la adopción y el uso efectivo
              de la Inteligencia Artificial Generativa?
              <span class="instruction"
                >Por favor, selecciona hasta 3 opciones.</span
              >
            </label>
            <div class="checkbox-group" id="liderNecesidadesCheckboxGroup">
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Capacitación y entrenamiento especializado para mi equipo en herramientas y aplicaciones de IA."
                />
                <span
                  >Capacitación y entrenamiento especializado para mi equipo en
                  herramientas y aplicaciones de IA.</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Acompañamiento y consultoría externa para identificar casos de uso y estrategias de implementación."
                />
                <span
                  >Acompañamiento y consultoría externa para identificar casos
                  de uso y estrategias de implementación.</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Definición de procesos claros y metodologías para la gestión del cambio y adopción de IA."
                />
                <span
                  >Definición de procesos claros y metodologías para la gestión
                  del cambio y adopción de IA.</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Acceso a equipos o roles expertos en IA dentro de la organización (científicos de datos, ingenieros de IA)."
                />
                <span
                  >Acceso a equipos o roles expertos en IA dentro de la
                  organización (científicos de datos, ingenieros de IA).</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Disponibilidad de plataformas tecnológicas y herramientas de IA robustas y seguras."
                />
                <span
                  >Disponibilidad de plataformas tecnológicas y herramientas de
                  IA robustas y seguras.</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Casos de éxito y ejemplos concretos de aplicación de IA en funciones o industrias similares."
                />
                <span
                  >Casos de éxito y ejemplos concretos de aplicación de IA en
                  funciones o industrias similares.</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Presupuesto dedicado y recursos financieros para invertir en proyectos de IA."
                />
                <span
                  >Presupuesto dedicado y recursos financieros para invertir en
                  proyectos de IA.</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Mayor claridad sobre los aspectos éticos y de cumplimiento normativo relacionados con la IA."
                />
                <span
                  >Mayor claridad sobre los aspectos éticos y de cumplimiento
                  normativo relacionados con la IA.</span
                >
              </label>
              <label class="checkbox-option">
                <input
                  type="checkbox"
                  name="lider_ia_necesidades"
                  value="Otro"
                  id="lider_ia_necesidad_otro_checkbox"
                />
                <span>Otro (especificar):</span>
                <span class="otro-input-container">
                  <input
                    type="text"
                    name="lider_ia_necesidades_otro_texto"
                    id="lider_ia_necesidades_otro_texto"
                    placeholder="Especifique aquí"
                    style="display: none"
                  />
                </span>
              </label>
            </div>
          </div>

          <div class="question">
            <label class="question-label" for="principal_beneficio_d">
              <span class="question-number"></span>Pensando en los workflows que
              identificaste como importantes, ¿cuál crees que sería el
              <strong>principal beneficio</strong> de incorporar IA Generativa
              para automatizarlos o asistirlos?
            </label>
            <textarea
              id="principal_beneficio_d"
              name="principal_beneficio"
              rows="4"
              placeholder="Ej: Reducción significativa de tiempo, mejora en la calidad de entregables, poder enfocarme en tareas más estratégicas, etc."
            ></textarea>
          </div>

          <div class="question">
            <label class="question-label" for="mayor_preocupacion_d">
              <span class="question-number"></span>¿Cuál es tu
              <strong>mayor preocupación o el principal reto</strong> que
              visualizas al pensar en implementar o usar más intensivamente la
              IA Generativa en tu trabajo diario o en tu equipo?
            </label>
            <textarea
              id="mayor_preocupacion_d"
              name="mayor_preocupacion"
              rows="4"
              placeholder="Ej: Curva de aprendizaje, seguridad de la información, calidad de los resultados de la IA, resistencia al cambio, costos, falta de conocimiento, etc."
            ></textarea>
          </div>
          <div class="question">
            <label class="question-label" for="ideas_ia_d">
              <span class="question-number"></span>(Opcional) ¿Tienes alguna
              idea específica de alguna herramienta o "agente de IA" que te
              gustaría tener para facilitar tu trabajo?
            </label>
            <textarea
              id="ideas_ia_d"
              name="ideas_ia"
              rows="3"
              placeholder="Ej: Un asistente que me resuma los correos importantes cada mañana, una IA que genere borradores de informes basados en datos de ventas, etc."
            ></textarea>
          </div>

          <div class="validation-message" id="validationMessageD">
            Por favor, completa las preguntas obligatorias de este bloque para
            finalizar.
          </div>
          <div class="navigation-buttons">
            <button class="btn btn-secondary" onclick="prevBlock()">
              Anterior
            </button>
            <button class="btn btn-primary" onclick="finishSurvey()">
              Finalizar Encuesta
            </button>
          </div>
        </div>

        <div class="block" id="results">
          <div class="completion-message">
            <h2 class="completion-title">
              ¡Muchas gracias por tu tiempo y tus respuestas!
            </h2>
            <p class="completion-text">
              Tu participación es muy valiosa para nosotros. Los datos
              recopilados nos ayudarán a enfocar nuestros esfuerzos en
              desarrollar soluciones de IA que realmente aporten valor y
              faciliten el trabajo diario.
            </p>
            <p
              class="completion-text"
              style="margin-top: 20px; font-size: 0.9em"
            >
              Si tienes alguna pregunta o comentario adicional, no dudes en
              contactarnos.
            </p>
          </div>

          <div class="navigation-buttons" style="justify-content: center; gap: 20px;">
            <button class="btn btn-secondary" onclick="downloadResults()">
              Descargar Resultados
            </button>
            <button class="btn btn-secondary" onclick="restartSurvey()">
              Completar Nueva Encuesta
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Variables globales
      let currentBlock = 0;
      let surveyData = {};
      // selectedWorkflowsForRanking is populated in updateRankingList
      let additionalWorkflowCount = 0; // Start at 0, increment before creating the first one

      // Bloques de la encuesta
      const blocks = [
        "intro",
        "blockA",
        "blockB",
        "blockC",
        "blockC2",
        "blockD",
        "results",
      ];
      // Unique IDs for validation messages for each block that needs one
      const validationMessagesIds = {
        blockA: "validationMessageA",
        blockB: "validationMessageB",
        blockC: "validationMessageC",
        blockC2: "validationMessageC2",
        blockD: "validationMessageD",
      };

      // Inicialización
      document.addEventListener("DOMContentLoaded", function () {
        setupEventListeners();
        updateProgress();
        showBlock(currentBlock); // Show the initial block (intro)
      });

      function setupEventListeners() {
        // Listeners para opciones de radio
        document.querySelectorAll(".radio-option").forEach((option) => {
          option.addEventListener("click", function (event) {
            const input = this.querySelector('input[type="radio"]');
            if (input && !input.checked) {
              // Only process if not already checked
              input.checked = true;
              const changeEvent = new Event("change", { bubbles: true });
              input.dispatchEvent(changeEvent);
            }
          });
        });
        document.querySelectorAll('input[type="radio"]').forEach((radio) => {
          radio.addEventListener("change", function () {
            // Handles actual change
            document
              .querySelectorAll(`input[name="${this.name}"]`)
              .forEach((otherRadio) => {
                otherRadio
                  .closest(".radio-option")
                  .classList.remove("selected");
              });
            if (this.checked) {
              this.closest(".radio-option").classList.add("selected");
            }
          });
        });

        // Listeners para escalas Likert
        document.querySelectorAll(".scale-option").forEach((option) => {
          option.addEventListener("click", function () {
            const value = this.dataset.value;
            const scale = this.closest(".likert-scale");
            const hiddenInput = scale.parentElement.querySelector(
              'input[type="hidden"]'
            );

            scale.querySelectorAll(".scale-option").forEach((opt) => {
              opt.classList.remove("selected");
            });

            this.classList.add("selected");
            if (hiddenInput) {
              hiddenInput.value = value;
            }
          });
        });

        // Listeners para workflows checkboxes
        document.querySelectorAll(".workflow-checkbox").forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            updateWorkflowDetails();
          });
        });

        // Listeners para la nueva pregunta condicional (lider_ia_necesidades)
        const liderNecesidadesCheckboxes = document.querySelectorAll(
          '#liderNecesidadesCheckboxGroup input[type="checkbox"]'
        );
        liderNecesidadesCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function (e) {
            const checkedCount = document.querySelectorAll(
              '#liderNecesidadesCheckboxGroup input[type="checkbox"]:checked'
            ).length;
            if (checkedCount > 3) {
              this.checked = false; // Prevent checking more than 3
              const validationMsgElement = document.getElementById(
                validationMessagesIds["blockD"]
              );
              if (validationMsgElement) {
                validationMsgElement.textContent =
                  "Puedes seleccionar un máximo de 3 opciones para las necesidades de IA.";
                validationMsgElement.classList.add("show");
                setTimeout(() => {
                  if (
                    validationMsgElement.textContent ===
                    "Puedes seleccionar un máximo de 3 opciones para las necesidades de IA."
                  ) {
                    validationMsgElement.classList.remove("show");
                  }
                }, 3000);
              }
            }
            // Handle "Otro" text input visibility
            if (this.id === "lider_ia_necesidad_otro_checkbox") {
              document.getElementById(
                "lider_ia_necesidades_otro_texto"
              ).style.display = this.checked ? "block" : "none";
              if (!this.checked) {
                document.getElementById(
                  "lider_ia_necesidades_otro_texto"
                ).value = "";
              }
            }
            // Update selected class for visual feedback
            this.closest(".checkbox-option").classList.toggle(
              "selected",
              this.checked
            );
          });
        });
      }

      function nextBlock() {
        if (!validateCurrentBlock()) {
          return;
        }
        saveBlockData();

        const currentBlockId = blocks[currentBlock];
        if (currentBlockId === "blockA") {
          const familiaridadScore =
            parseInt(surveyData["familiaridad_score"]) || 0;
          const knowledgeQuizElement = document.getElementById("knowledgeQuiz");
          if (knowledgeQuizElement) {
            if (familiaridadScore <= 2) {
              knowledgeQuizElement.style.display = "none";
              knowledgeQuizElement
                .querySelectorAll('input[type="hidden"]')
                .forEach((input) => (input.value = ""));
              knowledgeQuizElement
                .querySelectorAll(".scale-option.selected")
                .forEach((opt) => opt.classList.remove("selected"));
            } else {
              knowledgeQuizElement.style.display = "block";
            }
          }
        } else if (currentBlockId === "blockC") {
          updateRankingList();
        }

        currentBlock++;
        if (currentBlock < blocks.length) {
          showBlock(currentBlock);
          updateProgress();
        }
      }

      function prevBlock() {
        if (currentBlock > 0) {
          currentBlock--;
          showBlock(currentBlock);
          updateProgress();
        }
      }

      function updateQuestionNumbersBlockD(isLiderQuestionVisible) {
        const blockDElement = document.getElementById("blockD");
        if (!blockDElement) return;

        const questionsToNumber = [
          blockDElement.querySelector('label[for="principal_beneficio_d"]'),
          blockDElement.querySelector('label[for="mayor_preocupacion_d"]'),
          blockDElement.querySelector('label[for="ideas_ia_d"]'),
        ].filter((el) => el);

        let currentNumber = 1;
        if (isLiderQuestionVisible) {
          currentNumber = 2;
        }

        questionsToNumber.forEach((label) => {
          let numberSpan = label.querySelector(".question-number");
          if (!numberSpan) {
            numberSpan = document.createElement("span");
            numberSpan.className = "question-number";
            label.prepend(document.createTextNode(" "));
            label.prepend(numberSpan);
          }
          numberSpan.textContent = `${currentNumber}. `;
          currentNumber++;
        });
      }

      function showBlock(index) {
        document.querySelectorAll(".block").forEach((block) => {
          block.classList.remove("active");
        });
        const blockIdToShow = blocks[index];
        const blockElementToShow = document.getElementById(blockIdToShow);

        if (blockElementToShow) {
          if (blockIdToShow === "blockD") {
            const tamanoEquipo = surveyData["tamano_equipo"];
            const preguntaLiderElement = document.getElementById(
              "preguntaLiderNecesidadesIA"
            );
            const isLiderQuestionVisible = tamanoEquipo && tamanoEquipo !== "0";

            if (preguntaLiderElement) {
              preguntaLiderElement.style.display = isLiderQuestionVisible
                ? "block"
                : "none";
            }
            updateQuestionNumbersBlockD(isLiderQuestionVisible);
          }
          blockElementToShow.classList.add("active");
          window.scrollTo(0, 0);
        }
      }

      function updateProgress() {
        const surveySteps = blocks.length - 2;
        let completedSteps = currentBlock - 1;
        if (currentBlock === 0) completedSteps = -1;
        if (currentBlock === blocks.length - 1) completedSteps = surveySteps;

        let progressPercentage = 0;
        if (completedSteps >= 0 && surveySteps > 0) {
          progressPercentage = (completedSteps / surveySteps) * 100;
        }
        if (currentBlock === blocks.length - 1) progressPercentage = 100;

        document.getElementById("progressFill").style.width =
          Math.min(100, Math.max(0, progressPercentage)) + "%";
      }

      function validateCurrentBlock() {
        const blockId = blocks[currentBlock];
        const validationMessageId = validationMessagesIds[blockId];
        let validationMessageElement = null;
        if (validationMessageId) {
          validationMessageElement =
            document.getElementById(validationMessageId);
        }

        let isValid = true;

        if (validationMessageElement) {
          validationMessageElement.textContent =
            "Por favor, responde todas las preguntas obligatorias de este bloque para continuar."; // Default message
          validationMessageElement.classList.remove("show");
        }

        switch (blockId) {
          case "blockA":
            const requiredTextA = [
              "nombre_completo",
              "cargo_actual",
              "area_departamento",
            ]; // Updated fields
            requiredTextA.forEach((fieldName) => {
              const input = document.querySelector(
                `#${blockId} [name="${fieldName}"]`
              );
              if (!input || !input.value.trim()) isValid = false;
            });
            if (
              !document.querySelector(
                `#${blockId} [name="tamano_equipo"]:checked`
              )
            )
              isValid = false;
            if (
              !document.querySelector(
                `#${blockId} [name="tiempo_operativo"]:checked`
              )
            )
              isValid = false;
            if (!document.getElementById("familiaridadScore").value)
              isValid = false;
            break;

          case "blockB":
            const knowledgeQuizVisible =
              document.getElementById("knowledgeQuiz")?.style.display !==
              "none";
            const likertInputsB = [];
            if (knowledgeQuizVisible) {
              likertInputsB.push("b1_1", "b1_2", "b1_3");
            }
            likertInputsB.push(
              "b2_1",
              "b2_2",
              "b2_3",
              "b3_1",
              "b3_2",
              "b3_3",
              "b3_4",
              "b3_5"
            );

            likertInputsB.forEach((fieldName) => {
              const input = document.querySelector(
                `#${blockId} input[name="${fieldName}"]`
              );
              if (input && !input.value) {
                isValid = false;
              }
            });
            break;

          case "blockC":
            const selectedCheckboxes = document.querySelectorAll(
              "#blockC .workflow-checkbox:checked"
            );
            if (selectedCheckboxes.length === 0) {
              isValid = false;
              if (validationMessageElement)
                validationMessageElement.textContent =
                  "Debe seleccionar al menos un workflow.";
            } else {
              selectedCheckboxes.forEach((checkbox) => {
                const workflowName = checkbox.dataset.workflow;
                const workflowId = workflowName.replace(/\s+/g, "_");
                const freqInput = document.querySelector(
                  `#detailsContainer select[name="freq_${workflowId}"]`
                );
                const dolorInput = document.querySelector(
                  `#detailsContainer select[name="dolor_${workflowId}"]`
                );
                const nivelInput = document.querySelector(
                  `#detailsContainer select[name="nivel_${workflowId}"]`
                );

                if (
                  !freqInput ||
                  !freqInput.value ||
                  !dolorInput ||
                  !dolorInput.value ||
                  !nivelInput ||
                  !nivelInput.value
                ) {
                  isValid = false;
                  if (validationMessageElement)
                    validationMessageElement.textContent = `Complete los detalles (Frecuencia, Dolor y Nivel) para el workflow: "${workflowName}".`;
                }
              });
            }
            break;
          case "blockC2":
            const additionalWorkflowElements = document.querySelectorAll(
              "#additionalWorkflows .additional-workflow"
            );
            additionalWorkflowElements.forEach((wfElement) => {
              const descInput = wfElement.querySelector(
                `input[name^="additional_desc_"]`
              );
              const freqInput = wfElement.querySelector(
                `select[name^="additional_freq_"]`
              );
              const dolorInput = wfElement.querySelector(
                `select[name^="additional_dolor_"]`
              );
              if (descInput && descInput.value.trim()) {
                if (
                  !freqInput ||
                  !freqInput.value ||
                  !dolorInput ||
                  !dolorInput.value
                ) {
                  isValid = false;
                  if (validationMessageElement)
                    validationMessageElement.textContent = `Complete Frecuencia y Dolor para el workflow adicional "${descInput.value.trim()}".`;
                }
              }
            });
            break;
          case "blockD":
            const preguntaLiderElement = document.getElementById(
              "preguntaLiderNecesidadesIA"
            );
            if (
              preguntaLiderElement &&
              preguntaLiderElement.style.display !== "none"
            ) {
              const liderNecesidadesChecked = document.querySelectorAll(
                '#liderNecesidadesCheckboxGroup input[type="checkbox"]:checked'
              ).length;
              if (
                liderNecesidadesChecked === 0 ||
                liderNecesidadesChecked > 3
              ) {
                isValid = false;
                if (validationMessageElement)
                  validationMessageElement.textContent =
                    "Por favor, seleccione de 1 a 3 opciones para las necesidades de IA como líder.";
              }
              const otroCheckbox = document.getElementById(
                "lider_ia_necesidad_otro_checkbox"
              );
              const otroTexto = document.getElementById(
                "lider_ia_necesidades_otro_texto"
              );
              if (
                otroCheckbox &&
                otroCheckbox.checked &&
                (!otroTexto || !otroTexto.value.trim())
              ) {
                isValid = false;
                if (validationMessageElement && isValid) {
                  // Only set if not already set by count error
                  validationMessageElement.textContent =
                    'Si selecciona "Otro" para las necesidades de IA, por favor especifique el texto.';
                } else if (
                  validationMessageElement &&
                  !isValid &&
                  liderNecesidadesChecked > 0 &&
                  liderNecesidadesChecked <= 3
                ) {
                  // If previous error was about count, but count is now fine, then this is the new error
                  validationMessageElement.textContent =
                    'Si selecciona "Otro" para las necesidades de IA, por favor especifique el texto.';
                }
              }
            }
            if (
              !document
                .querySelector(`#${blockId} [name="principal_beneficio"]`)
                ?.value.trim() ||
              !document
                .querySelector(`#${blockId} [name="mayor_preocupacion"]`)
                ?.value.trim()
            ) {
              if (isValid && validationMessageElement) {
                // Only set if not already invalid by "lider" question
                validationMessageElement.textContent =
                  "Por favor, complete las preguntas sobre el principal beneficio y la mayor preocupación.";
              }
              isValid = false;
            }
            break;
        }

        if (!isValid && validationMessageElement) {
          validationMessageElement.classList.add("show");
        }
        return isValid;
      }

      function saveBlockData() {
        const currentBlockElement = document.getElementById(
          blocks[currentBlock]
        );
        if (!currentBlockElement) return;

        const inputs = currentBlockElement.querySelectorAll(
          "input, select, textarea"
        );
        // Clear previous lider_ia_necesidades for Block D before saving new ones
        if (blocks[currentBlock] === "blockD") {
          surveyData.lider_ia_necesidades = [];
        }

        inputs.forEach((input) => {
          const name = input.name;
          if (!name) return;

          if (input.type === "radio") {
            if (input.checked) surveyData[name] = input.value;
          } else if (
            input.type === "checkbox" &&
            input.classList.contains("workflow-checkbox")
          ) {
            // Handled by workflow_details
          } else if (input.type === "hidden") {
            surveyData[name] = input.value;
          } else if (
            input.tagName === "SELECT" &&
            (name.startsWith("freq_") ||
              name.startsWith("dolor_") ||
              name.startsWith("nivel_"))
          ) {
            const detailType = name.substring(0, name.indexOf("_"));
            const workflowId = name.substring(name.indexOf("_") + 1);
            let originalWorkflowName = "";
            document.querySelectorAll(".workflow-checkbox").forEach((cb) => {
              if (cb.dataset.workflow.replace(/\s+/g, "_") === workflowId) {
                originalWorkflowName = cb.dataset.workflow;
              }
            });
            if (originalWorkflowName) {
              if (!surveyData.workflow_details)
                surveyData.workflow_details = {};
              if (!surveyData.workflow_details[originalWorkflowName])
                surveyData.workflow_details[originalWorkflowName] = {
                  name: originalWorkflowName,
                };
              surveyData.workflow_details[originalWorkflowName][detailType] =
                input.value;
            }
          } else if (name.startsWith("additional_")) {
            if (!surveyData.additional_workflows_data)
              surveyData.additional_workflows_data = {};
            const parts = name.split("_");
            const field = parts[1];
            const index = parts[2];
            if (!surveyData.additional_workflows_data[index])
              surveyData.additional_workflows_data[index] = {};
            surveyData.additional_workflows_data[index][field] = input.value;
          } else if (name === "lider_ia_necesidades") {
            if (input.checked && input.value !== "Otro") {
              surveyData.lider_ia_necesidades.push(input.value);
            }
          } else if (name === "lider_ia_necesidades_otro_texto") {
            const otroCheckbox = document.getElementById(
              "lider_ia_necesidad_otro_checkbox"
            );
            if (otroCheckbox && otroCheckbox.checked && input.value.trim()) {
              // Ensure 'lider_ia_necesidades' array exists
              if (!surveyData.lider_ia_necesidades)
                surveyData.lider_ia_necesidades = [];
              // Check if "Otro: " is already prepended to avoid duplicates on resave
              const existingOtro = surveyData.lider_ia_necesidades.find(
                (item) => item.startsWith("Otro:")
              );
              if (existingOtro) {
                // Remove old "Otro" before adding new one
                surveyData.lider_ia_necesidades =
                  surveyData.lider_ia_necesidades.filter(
                    (item) => !item.startsWith("Otro:")
                  );
              }
              surveyData.lider_ia_necesidades.push(
                `Otro: ${input.value.trim()}`
              );
            }
          } else {
            surveyData[name] = input.value.trim();
          }
        });

        if (blocks[currentBlock] === "blockC") {
          surveyData.selected_workflows_for_ranking = Array.from(
            document.querySelectorAll("#blockC .workflow-checkbox:checked")
          ).map((cb) => cb.dataset.workflow);
        }

        if (blocks[currentBlock] === "blockC2") {
          const rankedItems = document.querySelectorAll(
            "#rankingList .ranking-item"
          );
          surveyData.ranked_workflows_order = Array.from(rankedItems).map(
            (item) => item.dataset.workflow
          );
        }
        console.log(
          "Survey Data after block " + blocks[currentBlock] + ":",
          JSON.parse(JSON.stringify(surveyData))
        );
      }

      function updateWorkflowDetails() {
        const selectedCheckboxes = document.querySelectorAll(
          "#blockC .workflow-checkbox:checked"
        );
        const detailsContainer = document.getElementById("detailsContainer");
        const workflowDetailsSection =
          document.getElementById("workflowDetails");

        detailsContainer.innerHTML = "";

        if (selectedCheckboxes.length > 0) {
          workflowDetailsSection.classList.add("active");

          selectedCheckboxes.forEach((checkbox) => {
            const workflowName = checkbox.dataset.workflow;
            const workflowId = workflowName.replace(/\s+/g, "_");

            const detailDiv = document.createElement("div");
            detailDiv.className = "detail-row-container";

            const savedDetails = surveyData.workflow_details
              ? surveyData.workflow_details[workflowName]
              : null;
            const savedFreq = savedDetails?.freq || "";
            const savedDolor = savedDetails?.dolor || "";
            const savedNivel = savedDetails?.nivel || "";

            detailDiv.innerHTML = `
                        <div>${workflowName}</div> <div class="detail-row">
                            <div class="detail-item">
                                <label for="freq_${workflowId}">Frecuencia</label>
                                <select id="freq_${workflowId}" name="freq_${workflowId}" required>
                                    <option value="" ${
                                      savedFreq === "" ? "selected" : ""
                                    }>Seleccionar...</option>
                                    <option value="D" ${
                                      savedFreq === "D" ? "selected" : ""
                                    }>Diario</option>
                                    <option value="S" ${
                                      savedFreq === "S" ? "selected" : ""
                                    }>Semanal</option>
                                    <option value="M" ${
                                      savedFreq === "M" ? "selected" : ""
                                    }>Mensual</option>
                                </select>
                            </div>
                            <div class="detail-item">
                                <label for="dolor_${workflowId}">Dolor/Consumo de Tiempo (1-5)</label>
                                <select id="dolor_${workflowId}" name="dolor_${workflowId}" required>
                                    <option value="" ${
                                      savedDolor === "" ? "selected" : ""
                                    }>Seleccionar...</option>
                                    <option value="1" ${
                                      savedDolor === "1" ? "selected" : ""
                                    }>1 - Muy bajo</option>
                                    <option value="2" ${
                                      savedDolor === "2" ? "selected" : ""
                                    }>2 - Bajo</option>
                                    <option value="3" ${
                                      savedDolor === "3" ? "selected" : ""
                                    }>3 - Medio</option>
                                    <option value="4" ${
                                      savedDolor === "4" ? "selected" : ""
                                    }>4 - Alto</option>
                                    <option value="5" ${
                                      savedDolor === "5" ? "selected" : ""
                                    }>5 - Muy alto</option>
                                </select>
                            </div>
                            <div class="detail-item">
                                <label for="nivel_${workflowId}">Nivel de Ejecución</label>
                                <select id="nivel_${workflowId}" name="nivel_${workflowId}" required>
                                    <option value="" ${
                                      savedNivel === "" ? "selected" : ""
                                    }>Seleccionar...</option>
                                    <option value="Personal" ${
                                      savedNivel === "Personal"
                                        ? "selected"
                                        : ""
                                    }>Personal (lo hago yo)</option>
                                    <option value="Equipo" ${
                                      savedNivel === "Equipo" ? "selected" : ""
                                    }>Equipo (coordino/gestiono)</option>
                                </select>
                            </div>
                        </div>
                    `;
            detailsContainer.appendChild(detailDiv);
          });
        } else {
          workflowDetailsSection.classList.remove("active");
        }
      }

      function updateRankingList() {
        const rankingList = document.getElementById("rankingList");
        const workflowsToRank = surveyData.selected_workflows_for_ranking || [];
        const displayableWorkflows = workflowsToRank.slice(0, 5);

        if (displayableWorkflows.length === 0) {
          rankingList.innerHTML =
            "<p>No has seleccionado workflows en el paso anterior. Vuelve al paso C para seleccionar y detallar workflows.</p>";
          return;
        }

        rankingList.innerHTML = "";
        displayableWorkflows.forEach((workflowName, index) => {
          const item = document.createElement("div");
          item.className = "ranking-item";
          item.draggable = true;
          item.dataset.workflow = workflowName;
          item.innerHTML = `
                    <span>${index + 1}.</span>
                    <span>${workflowName}</span>
                    <span>&#x2630;</span> `;
          rankingList.appendChild(item);
        });
        setupDragAndDrop();
      }

      let draggedElement = null;
      function setupDragAndDrop() {
        const rankingList = document.getElementById("rankingList");
        if (!rankingList) return;
        const items = rankingList.querySelectorAll(".ranking-item");
        items.forEach((item) => {
          item.addEventListener("dragstart", (e) => {
            draggedElement = item;
            setTimeout(() => item.classList.add("dragging"), 0);
            e.dataTransfer.effectAllowed = "move";
          });
          item.addEventListener("dragend", () => {
            draggedElement?.classList.remove("dragging");
            draggedElement = null;
            updateRankingNumbers();
          });
        });

        rankingList.addEventListener("dragover", (e) => {
          e.preventDefault();
          const afterElement = getDragAfterElement(rankingList, e.clientY);
          if (draggedElement) {
            if (afterElement == null) {
              rankingList.appendChild(draggedElement);
            } else {
              rankingList.insertBefore(draggedElement, afterElement);
            }
          }
        });
      }

      function getDragAfterElement(container, y) {
        const draggableElements = [
          ...container.querySelectorAll(".ranking-item:not(.dragging)"),
        ];
        return draggableElements.reduce(
          (closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
              return { offset: offset, element: child };
            } else {
              return closest;
            }
          },
          { offset: Number.NEGATIVE_INFINITY }
        ).element;
      }

      function updateRankingNumbers() {
        const items = document.querySelectorAll("#rankingList .ranking-item");
        items.forEach((item, index) => {
          const numberSpan = item.querySelector("span:first-child");
          if (numberSpan) numberSpan.textContent = `${index + 1}.`;
        });
      }

      function addAdditionalWorkflow() {
        if (additionalWorkflowCount >= 2) {
          document.getElementById("addWorkflowBtn").style.display = "none";
          return;
        }
        additionalWorkflowCount++;
        const container = document.getElementById("additionalWorkflows");
        const workflowDiv = document.createElement("div");
        workflowDiv.className = "additional-workflow";
        workflowDiv.id = `additional_wf_container_${additionalWorkflowCount}`;

        workflowDiv.innerHTML = `
                <h4>Workflow Adicional #${additionalWorkflowCount}</h4>
                <div class="form-group">
                    <label for="additional_desc_${additionalWorkflowCount}">Descripción breve de la tarea (Ej: Transcribir audios de entrevistas)</label>
                    <input type="text" id="additional_desc_${additionalWorkflowCount}" name="additional_desc_${additionalWorkflowCount}" maxlength="150" placeholder="Describe brevemente el workflow">
                </div>
                <div class="form-group">
                    <label for="additional_output_${additionalWorkflowCount}">Output o resultado esperado de esta tarea (Ej: Texto transcrito en un documento)</label>
                    <textarea id="additional_output_${additionalWorkflowCount}" name="additional_output_${additionalWorkflowCount}" rows="2" placeholder="¿Qué resultado esperas obtener?"></textarea>
                </div>
                <div class="detail-row">
                    <div class="detail-item">
                        <label for="additional_freq_${additionalWorkflowCount}">Frecuencia</label>
                        <select id="additional_freq_${additionalWorkflowCount}" name="additional_freq_${additionalWorkflowCount}">
                            <option value="">Seleccionar...</option>
                            <option value="D">Diario</option>
                            <option value="S">Semanal</option>
                            <option value="M">Mensual</option>
                            <option value="O">Ocasional</option>
                        </select>
                    </div>
                    <div class="detail-item">
                        <label for="additional_dolor_${additionalWorkflowCount}">Dolor/Consumo de Tiempo (1-5)</label>
                        <select id="additional_dolor_${additionalWorkflowCount}" name="additional_dolor_${additionalWorkflowCount}">
                            <option value="">Seleccionar...</option>
                            <option value="1">1 - Muy bajo</option>
                            <option value="2">2 - Bajo</option>
                            <option value="3">3 - Medio</option>
                            <option value="4">4 - Alto</option>
                            <option value="5">5 - Muy alto</option>
                        </select>
                    </div>
                </div>
                <button type="button" onclick="removeAdditionalWorkflow(${additionalWorkflowCount})" class="btn-remove-wf">Eliminar este Workflow Adicional</button>
            `;
        container.appendChild(workflowDiv);
        if (additionalWorkflowCount >= 2) {
          document.getElementById("addWorkflowBtn").style.display = "none";
        }
      }

      function removeAdditionalWorkflow(idToRemove) {
        const workflowToRemove = document.getElementById(
          `additional_wf_container_${idToRemove}`
        );
        if (workflowToRemove) {
          workflowToRemove.remove();
          additionalWorkflowCount--;
          if (additionalWorkflowCount < 2) {
            document.getElementById("addWorkflowBtn").style.display = "block";
          }
        }
      }

      function finishSurvey() {
        console.log('Iniciando finishSurvey...');
        
        // Validar antes de continuar
        if (!validateCurrentBlock()) {
          console.log('Validación falló');
          return;
        }
        
        // Guardar datos del bloque actual
        saveBlockData();
        console.log('Datos guardados:', surveyData);
        
        // Encontrar el botón de finalizar usando una búsqueda más específica
        const finishButton = document.querySelector('button[onclick="finishSurvey()"]');
        if (finishButton) {
          finishButton.disabled = true;
          finishButton.textContent = "Enviando...";
        }
        
        // Enviar datos a Google Sheets
        sendToGoogleSheets(surveyData)
          .then(() => {
            console.log("Datos enviados exitosamente a Google Sheets");
            currentBlock = blocks.indexOf("results");
            showBlock(currentBlock);
            updateProgress();
          })
          .catch(error => {
            console.error("Error al enviar datos:", error);
            let errorMessage = "Hubo un error al enviar la encuesta.\n";
            
            if (error.message) {
              errorMessage += `\nDetalles: ${error.message}`;
            }
            
            errorMessage += "\n\nPor favor, verifica tu conexión a internet e intenta nuevamente.";
            errorMessage += "\n\nSi el problema persiste, puedes guardar tus respuestas usando el botón 'Descargar Resultados' en la página de finalización.";
            
            alert(errorMessage);
            
            if (finishButton) {
              finishButton.disabled = false;
              finishButton.textContent = "Finalizar Encuesta";
            }
          });
      }

      function downloadResults() {
        const dataStr =
          "data:text/json;charset=utf-8," +
          encodeURIComponent(JSON.stringify(surveyData, null, 2));
        const downloadAnchorNode = document.createElement("a");
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute(
          "download",
          `encuesta_ia_resultados_${new Date().toISOString().slice(0, 10)}.json`
        );
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
      }

      function restartSurvey() {
        if (
          confirm(
            "¿Estás seguro de que quieres reiniciar la encuesta? Se perderán todos los datos ingresados."
          )
        ) {
          surveyData = {};
          currentBlock = 0;
          additionalWorkflowCount = 0;

          document.getElementById("detailsContainer").innerHTML = "";
          document.getElementById("rankingList").innerHTML =
            "<p>Los workflows que seleccionaste y detallaste aparecerán aquí para que los ordenes.</p>";
          document.getElementById("additionalWorkflows").innerHTML = "";
          document.getElementById("addWorkflowBtn").style.display = "block";

          const formElementsContainer =
            document.querySelector(".survey-content");
          if (formElementsContainer) {
            formElementsContainer
              .querySelectorAll(
                'input[type="text"], input[type="number"], textarea, input[type="hidden"]'
              )
              .forEach((input) => (input.value = ""));
            formElementsContainer
              .querySelectorAll('input[type="radio"], input[type="checkbox"]')
              .forEach((input) => (input.checked = false));
            formElementsContainer
              .querySelectorAll("select")
              .forEach((select) => (select.selectedIndex = 0));
          }

          document
            .querySelectorAll(
              ".radio-option.selected, .scale-option.selected, .checkbox-option.selected"
            )
            .forEach((el) => el.classList.remove("selected"));

          const liderQuestion = document.getElementById(
            "preguntaLiderNecesidadesIA"
          );
          if (liderQuestion) liderQuestion.style.display = "none";
          const otroTextoLider = document.getElementById(
            "lider_ia_necesidades_otro_texto"
          );
          if (otroTextoLider) {
            otroTextoLider.style.display = "none";
            otroTextoLider.value = "";
          }

          const knowledgeQuiz = document.getElementById("knowledgeQuiz");
          if (knowledgeQuiz) knowledgeQuiz.style.display = "block";

          document
            .querySelectorAll(".validation-message.show")
            .forEach((msg) => msg.classList.remove("show"));
          document
            .querySelectorAll(".workflow-details.active")
            .forEach((el) => el.classList.remove("active"));

          showBlock(currentBlock);
          updateProgress();
          window.scrollTo(0, 0);
        }
      }

      // Función para enviar datos a Google Sheets
      async function sendToGoogleSheets(data) {
        // URL del Web App de Google Apps Script (deberás reemplazar esto con tu URL real)
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby7zWCWRKZqUuMhI4Vh6yksMdLsmiMY3c0jh334lykandzsr6D-GE7nSxFWD7eHpQGI/exec';
        
        // Agregar timestamp
        data.timestamp = new Date().toISOString();
        
        // Formatear los datos para envío
        const formattedData = formatDataForSheets(data);
        
        // Log para debugging
        console.log('Datos originales:', data);
        console.log('Datos formateados para enviar:', formattedData);
        console.log('Workflows seleccionados:', formattedData.workflows_seleccionados);
        
        try {
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'text/plain', // Google Apps Script prefiere text/plain para evitar preflight
            },
            body: JSON.stringify(formattedData)
          });
          
          // Intentar leer la respuesta
          let result;
          try {
            result = await response.json();
            console.log('Respuesta del servidor:', result);
          } catch (e) {
            // Si no se puede parsear como JSON, intentar como texto
            const textResult = await response.text();
            console.log('Respuesta del servidor (texto):', textResult);
          }
          
          if (response.ok) {
            console.log('Datos enviados exitosamente');
            return Promise.resolve();
          } else {
            throw new Error(`Error HTTP: ${response.status}`);
          }
        } catch (error) {
          console.error('Error al enviar a Google Sheets:', error);
          // Si es un error de CORS, intentar con el método alternativo
          if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
            console.log('Intentando envío alternativo sin CORS...');
            // Crear una imagen para enviar datos sin CORS
            const img = new Image();
            img.src = GOOGLE_SCRIPT_URL + '?data=' + encodeURIComponent(JSON.stringify(formattedData));
            return new Promise((resolve) => {
              img.onload = () => {
                console.log('Datos enviados por método alternativo');
                resolve();
              };
              img.onerror = () => {
                console.log('Datos posiblemente enviados (método alternativo)');
                resolve(); // Resolvemos de todos modos
              };
            });
          }
          throw error;
        }
      }

      // Función para formatear los datos para Google Sheets
      function formatDataForSheets(data) {
        const formatted = {
          // Datos básicos
          timestamp: data.timestamp,
          nombre_completo: data.nombre_completo || '',
          cargo_actual: data.cargo_actual || '',
          area_departamento: data.area_departamento || '',
          tamano_equipo: data.tamano_equipo || '',
          tiempo_operativo: data.tiempo_operativo || '',
          familiaridad_score: data.familiaridad_score || '',
          
          // Conocimiento y confianza
          b1_1: data.b1_1 || '',
          b1_2: data.b1_2 || '',
          b1_3: data.b1_3 || '',
          b2_1: data.b2_1 || '',
          b2_2: data.b2_2 || '',
          b2_3: data.b2_3 || '',
          b3_1: data.b3_1 || '',
          b3_2: data.b3_2 || '',
          b3_3: data.b3_3 || '',
          b3_4: data.b3_4 || '',
          b3_5: data.b3_5 || '',
          
          // Workflows seleccionados
          workflows_seleccionados: [],
          
          // Ranking de workflows
          ranking_workflows: data.ranked_workflows_order || [],
          
          // Necesidades del líder
          lider_ia_necesidades: data.lider_ia_necesidades || [],
          lider_ia_necesidades_otro: '',
          
          // Preguntas finales
          principal_beneficio: data.principal_beneficio || '',
          mayor_preocupacion: data.mayor_preocupacion || '',
          ideas_ia: data.ideas_ia || ''
        };
        
        // Extraer el texto de "Otro" si existe
        if (data.lider_ia_necesidades && Array.isArray(data.lider_ia_necesidades)) {
          const otroItem = data.lider_ia_necesidades.find(item => item.startsWith('Otro:'));
          if (otroItem) {
            formatted.lider_ia_necesidades_otro = otroItem.replace('Otro: ', '');
            // Filtrar el item "Otro:" de la lista principal
            formatted.lider_ia_necesidades = data.lider_ia_necesidades.filter(item => !item.startsWith('Otro:'));
          }
        }
        
        // Procesar workflows seleccionados desde workflow_details
        const workflowData = [];
        
        // Procesar los workflows desde data.workflow_details
        if (data.workflow_details) {
          Object.keys(data.workflow_details).forEach(workflowName => {
            const details = data.workflow_details[workflowName];
            workflowData.push({
              nombre: workflowName,
              frecuencia: details.freq || '',
              dolor: details.dolor || '',
              nivel: details.nivel || '',
              output: details.output || ''
            });
          });
        }
        
        // Procesar workflows adicionales
        if (data.additional_workflows_data) {
          Object.keys(data.additional_workflows_data).forEach(id => {
            const workflow = data.additional_workflows_data[id];
            if (workflow.desc) {
              workflowData.push({
                nombre: `ADICIONAL: ${workflow.desc}`,
                frecuencia: workflow.freq || '',
                dolor: workflow.dolor || '',
                nivel: 'N/A',
                output: workflow.output || ''
              });
            }
          });
        }
        
        formatted.workflows_seleccionados = workflowData;
        
        return formatted;
      }
    </script>
  </body>
</html>
